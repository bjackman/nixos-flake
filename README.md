# Flake for configuring NixOS systems

This flake defines two NixOS systems, one called `base` which is just a kinda
minimal system, and one called `aethelred` which is intended for a specific
physical machine in my office.

You can run `base` in a VM like this:

```
nix run .#nixosConfigurations.base.config.system.build.vm
```

The details of what this does seem to be configured by a set of options under
`virtualisation.*` (to access these I needed to import
`${modulesPath}/virtualisation/qemu-vm.nix`). For example, because I set
`virtualisation.forwardPorts`, you can SSH into the guest with `ssh -p 2222
localhost`.

I installed NixOS using the installer on `aethelred`. I can then rebuild it
according to the config in this Flake by running `nixos-rebuild` with the
`--target-host` option. It seems in principle like it should have been possible
to directly generate the disk image and just splat the build directly onto the
machine's disk without needing to run an installer at all, but:

- I haven't figured out how to build disk images yet (although the QEMU VM built
  above does create a QCOW2 image).
- I don't know how I'd have genetaed `aethelred-hardware-configuration.nix` -
  that was generated by the NixOS installer and then I copied it off the
  machine.